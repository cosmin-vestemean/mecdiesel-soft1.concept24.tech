<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Code Filter Include/Exclude Enhancement - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <style>
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .feature-icon {
            font-size: 1.5rem;
            color: #0d6efd;
        }
        .layer-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .sql-highlight {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }
        .api-highlight {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }
        .ui-highlight {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }
        @media (max-width: 768px) {
            .before-after {
                grid-template-columns: 1fr;
            }
        }
        .demo-container {
            border: 2px dashed #dee2e6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="bi bi-filter-square"></i> Material Code Filter Documentation</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#overview">Overview</a></li>
                    <li class="nav-item"><a class="nav-link" href="#implementation">Implementation</a></li>
                    <li class="nav-item"><a class="nav-link" href="#usage">Usage</a></li>
                    <li class="nav-item"><a class="nav-link" href="#testing">Testing</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-3">
                <div class="position-sticky" style="top: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">Table of Contents</h6>
                        </div>
                        <div class="card-body">
                            <nav class="nav flex-column">
                                <a class="nav-link" href="#overview">Overview</a>
                                <a class="nav-link" href="#features">Features</a>
                                <a class="nav-link" href="#implementation">Implementation</a>
                                <a class="nav-link ms-3" href="#database">Database Layer</a>
                                <a class="nav-link ms-3" href="#backend">Backend Layer</a>
                                <a class="nav-link ms-3" href="#api">API Layer</a>
                                <a class="nav-link ms-3" href="#store">Store Layer</a>
                                <a class="nav-link ms-3" href="#ui">UI Layer</a>
                                <a class="nav-link" href="#usage">Usage Guide</a>
                                <a class="nav-link" href="#testing">Testing</a>
                                <a class="nav-link" href="#performance">Performance</a>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <!-- Overview Section -->
                <section id="overview" class="mb-5">
                    <h1><i class="bi bi-filter-square feature-icon"></i> Material Code Filter Include/Exclude Enhancement</h1>
                    <p class="lead">A comprehensive enhancement to the branch replenishment system that allows users to filter materials by code using both "LIKE" (include) and "NOT LIKE" (exclude) SQL patterns.</p>
                    
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        <strong>Status:</strong> Complete and implemented across all system layers
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-bullseye"></i> Objective</h5>
                                    <p class="card-text">Enable users to filter materials by code with the ability to toggle between including or excluding materials that start with a specified code pattern.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-lightning"></i> Benefits</h5>
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check text-success"></i> Database-level filtering for performance</li>
                                        <li><i class="bi bi-check text-success"></i> Intuitive UI with toggle switch</li>
                                        <li><i class="bi bi-check text-success"></i> Backward compatible implementation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Features Section -->
                <section id="features" class="mb-5">
                    <h2><i class="bi bi-stars"></i> Key Features</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-toggle-on feature-icon"></i>
                                    <h5 class="card-title">Toggle Switch</h5>
                                    <p class="card-text">Easy-to-use toggle to switch between include and exclude modes</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-eye feature-icon"></i>
                                    <h5 class="card-title">Dynamic UI</h5>
                                    <p class="card-text">Labels and help text update based on selected filtering mode</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-database feature-icon"></i>
                                    <h5 class="card-title">Database Filtering</h5>
                                    <p class="card-text">Filters applied at SQL level for optimal performance</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Implementation Section -->
                <section id="implementation" class="mb-5">
                    <h2><i class="bi bi-gear"></i> Implementation Details</h2>
                    <p>The enhancement was implemented across all system layers to ensure proper data flow and optimal performance.</p>

                    <!-- Database Layer -->
                    <div id="database" class="mb-4">
                        <h3><span class="badge bg-primary layer-badge">SQL</span> Database Layer</h3>
                        <div class="sql-highlight">
                            <strong>File:</strong> <code>reumplere/sp_GetMtrlsDat.sql</code>
                        </div>
                        
                        <h5>Parameter Added:</h5>
                        <div class="code-block">
                            <pre><code>@materialCodeFilterExclude BIT = 0  -- New parameter for exclusion mode</code></pre>
                        </div>

                        <h5>WHERE Clause Enhancement:</h5>
                        <div class="code-block">
                            <pre><code>AND (@materialCodeFilter IS NULL OR (
    (@materialCodeFilterExclude = 0 AND m.Code LIKE @materialCodeFilter + '%') OR
    (@materialCodeFilterExclude = 1 AND m.Code NOT LIKE @materialCodeFilter + '%')
))</code></pre>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            When <code>@materialCodeFilterExclude = 0</code>: Uses <strong>LIKE</strong> pattern (Include mode)<br>
                            When <code>@materialCodeFilterExclude = 1</code>: Uses <strong>NOT LIKE</strong> pattern (Exclude mode)
                        </div>
                    </div>

                    <!-- Backend Layer -->
                    <div id="backend" class="mb-4">
                        <h3><span class="badge bg-success layer-badge">Backend</span> ERP Service Layer</h3>
                        <div class="api-highlight">
                            <strong>File:</strong> <code>reumplere/ReumplereSucursale.js</code>
                        </div>

                        <h5>Parameter Extraction:</h5>
                        <div class="code-block">
                            <pre><code>var materialCodeFilterExclude = apiObj.hasOwnProperty('materialCodeFilterExclude') 
    ? apiObj.materialCodeFilterExclude : false;</code></pre>
                        </div>

                        <h5>Stored Procedure Call:</h5>
                        <div class="code-block">
                            <pre><code>", @materialCodeFilterExclude = " + (materialCodeFilterExclude ? "1" : "0");</code></pre>
                        </div>
                    </div>

                    <!-- API Layer -->
                    <div id="api" class="mb-4">
                        <h3><span class="badge bg-info layer-badge">API</span> Express Service Layer</h3>
                        <div class="api-highlight">
                            <strong>File:</strong> <code>src/app.js</code>
                        </div>

                        <h5>API Payload Enhancement:</h5>
                        <div class="code-block">
                            <pre><code>materialCodeFilterExclude: data.materialCodeFilterExclude !== undefined 
    ? data.materialCodeFilterExclude : false</code></pre>
                        </div>
                    </div>

                    <!-- Store Layer -->
                    <div id="store" class="mb-4">
                        <h3><span class="badge bg-warning layer-badge">Store</span> State Management Layer</h3>
                        <div class="ui-highlight">
                            <strong>File:</strong> <code>public/stores/replenishment-store.js</code>
                        </div>

                        <h5>State Management:</h5>
                        <div class="code-block">
                            <pre><code>// State property
materialCodeFilterExclude: false

// Action handler
case 'SET_MATERIAL_CODE_FILTER_EXCLUDE':
    newState.materialCodeFilterExclude = Boolean(action.payload);
    cacheKeysToInvalidate = ['filteredData'];
    break;

// Public method
setMaterialCodeFilterExclude(exclude) {
    this.dispatch({ type: 'SET_MATERIAL_CODE_FILTER_EXCLUDE', payload: exclude });
}</code></pre>
                        </div>
                    </div>

                    <!-- UI Layer -->
                    <div id="ui" class="mb-4">
                        <h3><span class="badge bg-secondary layer-badge">UI</span> User Interface Layer</h3>
                        <div class="ui-highlight">
                            <strong>File:</strong> <code>public/components/query-panel.js</code>
                        </div>

                        <h5>Toggle Switch Implementation:</h5>
                        <div class="code-block">
                            <pre><code>&lt;div class="form-check form-switch"&gt;
    &lt;input class="form-check-input" type="checkbox" role="switch" 
           id="materialCodeFilterExclude"
           .checked=${this.materialCodeFilterExclude}
           @change=${e =&gt; this._dispatchUpdate('materialCodeFilterExclude', e.target.checked)}
           ?disabled=${this.loading || !this.materialCodeFilter}&gt;
    &lt;label class="form-check-label small" for="materialCodeFilterExclude"&gt;
        ${this.materialCodeFilterExclude ? 'Exclude' : 'Include'}
    &lt;/label&gt;
&lt;/div&gt;</code></pre>
                        </div>
                    </div>
                </section>

                <!-- Usage Guide -->
                <section id="usage" class="mb-5">
                    <h2><i class="bi bi-person-check"></i> Usage Guide</h2>
                    
                    <div class="demo-container">
                        <h5>Interactive Demo</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group input-group-sm mb-3">
                                    <span class="input-group-text">Material Code</span>
                                    <input type="text" class="form-control" id="demoMaterialCode" 
                                           placeholder="Enter material code..." value="AB">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="demoExclude">
                                    <label class="form-check-label" for="demoExclude">
                                        <span id="demoLabel">Include</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <strong>Result:</strong> <span id="demoResult">Include materials starting with "AB"</span>
                        </div>
                    </div>

                    <h5>Step-by-Step Usage:</h5>
                    <ol>
                        <li><strong>Enter Material Code:</strong> Type the material code pattern in the filter input</li>
                        <li><strong>Choose Mode:</strong> Use the toggle switch to select Include or Exclude mode</li>
                        <li><strong>Load Data:</strong> Click "Load Data" to apply the filter</li>
                        <li><strong>View Results:</strong> The data table will show filtered results based on your selection</li>
                    </ol>

                    <div class="before-after">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">Include Mode (Default)</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Filter:</strong> "AB" + Include</p>
                                <p><strong>SQL:</strong> <code>Code LIKE 'AB%'</code></p>
                                <p><strong>Result:</strong> Shows materials AB001, AB002, AB123, etc.</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header bg-danger text-white">
                                <h6 class="mb-0">Exclude Mode</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Filter:</strong> "AB" + Exclude</p>
                                <p><strong>SQL:</strong> <code>Code NOT LIKE 'AB%'</code></p>
                                <p><strong>Result:</strong> Shows all materials except those starting with AB</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Testing Section -->
                <section id="testing" class="mb-5">
                    <h2><i class="bi bi-bug"></i> Testing</h2>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        A comprehensive test file is available: <code>test-material-code-filter-exclude.html</code>
                    </div>

                    <h5>Test Cases Covered:</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Functional Tests</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check text-success"></i> Include mode filtering</li>
                                        <li><i class="bi bi-check text-success"></i> Exclude mode filtering</li>
                                        <li><i class="bi bi-check text-success"></i> Toggle state management</li>
                                        <li><i class="bi bi-check text-success"></i> Dynamic label updates</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Integration Tests</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-check text-success"></i> API parameter passing</li>
                                        <li><i class="bi bi-check text-success"></i> SQL query generation</li>
                                        <li><i class="bi bi-check text-success"></i> Store state synchronization</li>
                                        <li><i class="bi bi-check text-success"></i> UI responsiveness</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Performance Section -->
                <section id="performance" class="mb-5">
                    <h2><i class="bi bi-speedometer"></i> Performance Considerations</h2>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-database"></i> Database Performance</h5>
                                    <ul>
                                        <li>Filter applied at SQL level</li>
                                        <li>Reduces data transfer overhead</li>
                                        <li>Leverages existing indexes</li>
                                        <li>Optimal query execution</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-cpu"></i> Frontend Performance</h5>
                                    <ul>
                                        <li>Centralized state management</li>
                                        <li>Efficient cache invalidation</li>
                                        <li>Minimal re-renders</li>
                                        <li>Responsive UI updates</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Footer -->
                <footer class="mt-5 pt-4 border-top">
                    <div class="row">
                        <div class="col-md-8">
                            <p class="text-muted">
                                <i class="bi bi-calendar"></i> Last updated: July 2025<br>
                                <i class="bi bi-person"></i> Implementation: Complete and tested<br>
                                <i class="bi bi-shield-check"></i> Status: Production ready
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <p class="text-muted">
                                <i class="bi bi-code-slash"></i> Branch Replenishment System<br>
                                Material Code Filter Enhancement
                            </p>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Demo functionality
        const demoMaterialCode = document.getElementById('demoMaterialCode');
        const demoExclude = document.getElementById('demoExclude');
        const demoLabel = document.getElementById('demoLabel');
        const demoResult = document.getElementById('demoResult');

        function updateDemo() {
            const code = demoMaterialCode.value.trim();
            const isExclude = demoExclude.checked;
            
            demoLabel.textContent = isExclude ? 'Exclude' : 'Include';
            
            if (code) {
                const action = isExclude ? 'Exclude' : 'Include';
                demoResult.textContent = `${action} materials starting with "${code}"`;
                demoResult.className = isExclude ? 'text-danger' : 'text-success';
            } else {
                demoResult.textContent = 'Enter a material code to see the filter effect';
                demoResult.className = 'text-muted';
            }
            
            // Disable toggle if no code
            demoExclude.disabled = !code;
        }

        demoMaterialCode.addEventListener('input', updateDemo);
        demoExclude.addEventListener('change', updateDemo);
        
        // Initialize demo
        updateDemo();

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
